# Алгоритм Кнута-Морриса-Пратта (КМП) — это эффективный метод поиска
# подстроки, который использует пи-функцию для ускорения процесса путем
# избегания повторного сравнения символов.
#
# Префикс
# Префикс строки — это любой начальный сегмент этой строки. Другими
# словами, если у вас есть строка, префиксом будет любая часть этой
# строки, которая начинается с первого символа и заканчивается на любом
# другом символе внутри строки. Префикс может быть коротким, длинным или
# даже пустым (если не включает ни одного символа).
#
# Суффикс
# Суффикс строки — это любой конечный сегмент этой строки. Это значит,
# что суффиксом будет любая часть строки, начинающаяся с одного из её
# символов и продолжающаяся до конца строки. Как и префикс, суффикс
# может быть любой длины, включая пустую строку.
#
# Пример
# Рассмотрим строку "абракадабра". Вот несколько примеров префиксов и
# суффиксов для этой строки:
#
# Префиксы: "а", "абр", "абракад", "абракадабра" (вся строка), и
# "" (пустая строка).
# Суффиксы: "а", "дабра", "акадабра", "абракадабра" (вся строка), и
# "" (пустая строка).
# В контексте алгоритма Кнута-Морриса-Пратта, пи-функция помогает
# определять, насколько можно сдвинуть поиск подстроки вперёд, сравнивая
# префиксы и суффиксы подстроки для нахождения максимально возможного
# совпадения. Это позволяет избежать повторного сравнения символов,
# которые уже были сравнены.

# Разберем вычисление пи-функции для подстроки "ABCDABD", чтобы увидеть,
# как она работает на каждом шаге:
#
# Индекс 0 (символ 'A'):
#
# Подстрока: "A"
# Совпадающих префиксов и суффиксов нет.
# Пи-функция: 0
# Индекс 1 (символ 'B'):
#
# Подстрока: "AB"
# Префикс "A" не совпадает с суффиксом "B".
# Пи-функция: 0
# Индекс 2 (символ 'C'):
#
# Подстрока: "ABC"
# Нет совпадающих префиксов и суффиксов.
# Пи-функция: 0
# Индекс 3 (символ 'D'):
#
# Подстрока: "ABCD"
# Опять нет совпадающих префиксов и суффиксов.
# Пи-функция: 0
# Индекс 4 (второй символ 'A'):
#
# Подстрока: "ABCDA"
# Единственный совпадающий префикс и суффикс – "A".
# Пи-функция: 1
# Индекс 5 (второй символ 'B'):
#
# Подстрока: "ABCDAB"
# Совпадают префикс "AB" и суффикс "AB".
# Пи-функция: 2
# Индекс 6 (символ 'D'):
#
# Подстрока: "ABCDABD"
# Нет совпадающих префиксов и суффиксов.
# Пи-функция: 0
# В результате мы получаем массив пи-функции для "ABCDABD" следующего
# вида:
#
# A B C D A B D
# 0 0 0 0 1 2 0
#
# Как видите, на каждом шаге мы анализируем подстроку, заканчивающуюся
# на текущем символе, и ищем наибольшее совпадение префикса и суффикса.
# Эти значения пи-функции затем используются в алгоритме КМП для
# определения, насколько можно сдвинуть подстроку в случае несовпадения
# символов в основной строке, что позволяет избежать повторного
# сравнения символов, уже проверенных ранее.
def compute_pi_function(string):
    """
    Вычисляет пи-функцию для заданной строки.
    Пи-функция указывает длину наибольшего совпадающего префикса,
    который также является суффиксом
    для подстроки, заканчивающейся на каждом символе.

    Args:
    string (str): Строка, для которой вычисляется пи-функция.

    Returns:
    list: Массив, представляющий пи-функцию строки.
    """
    length = len(string)
    pi = [0] * length  # Инициализация массива пи-функции нулями
    j = 0  # Индекс для отслеживания длины текущего префикса
    # Проходим по строке, начиная со второго символа
    for i in range(1, length):
        # Пока j > 0 и текущий символ не совпадает с символом в префиксе,
        # возвращаемся к предыдущему возможному префиксу
        while j > 0 and string[j] != string[i]:
            j = pi[j - 1]
        # Если символы совпадают, увеличиваем j и обновляем пи-функцию
        if string[j] == string[i]:
            j += 1
        pi[i] = j
    return pi


def KMP_search(main_string, substring):
    """
    Выполняет поиск подстроки в строке, используя алгоритм
    Кнута-Морриса-Пратта.
    Алгоритм использует пи-функцию для определения, насколько сдвигать
    поиск, тем самым уменьшая количество необходимых сравнений.

    Args:
    main_string (str): Основная строка для поиска.
    substring (str): Подстрока, которую нужно найти.

    Returns:
    int: Индекс начала подстроки в основной строке или -1, если
    подстрока не найдена.
    """
    pi = compute_pi_function(substring)  # Вычисление пи-функции для подстроки
    j = 0  # Индекс в подстроке
    # Проходим по основной строке
    for i in range(len(main_string)):
        # Пока j > 0 и символы не совпадают, используем пи-функцию для сдвига
        while j > 0 and main_string[i] != substring[j]:
            j = pi[j - 1]
        # Если символы совпадают, увеличиваем j
        if main_string[i] == substring[j]:
            j += 1
        # Если достигнут конец подстроки, нашли совпадение
        if j == len(substring):
            return i - j + 1  # Возвращаем индекс начала подстроки в основной строке
    return -1  # Если подстрока не найдена


def main():
    result = KMP_search("abcxabcdabcdabcy", "abcdabcy")
    print(result)


if __name__ == "__main__":
    main()
